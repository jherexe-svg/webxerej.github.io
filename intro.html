<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nuestra Historia</title>

<style>
body{
  margin:0;
  background:black;
  overflow:hidden;
}

canvas{
  display:block;
}

button{
  position:fixed;
  bottom:60px;
  left:50%;
  transform:translateX(-50%);
  padding:12px 30px;
  border:none;
  border-radius:30px;
  background:linear-gradient(45deg,#ff2e63,#8b0000);
  color:white;
  font-size:14px;
  cursor:pointer;
  opacity:0;
  transition:1s ease;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>
<button id="btn" onclick="irGaleria()">Comenzar ❤️</button>

<audio id="musica" loop>
  <source src="those-eyes.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

let particles = [];
let stars = [];
let textIndex = 0;
let pulse = 0;

const texts = [
  "Algunas historias.",
  "no empiezan con una cita…",
  "empiezan con una mirada.",
  "Y esta…",
  "es la nuestra."
];

class Particle{
  constructor(x,y,color,special=false){
    this.x = Math.random()*canvas.width;
    this.y = Math.random()*canvas.height;
    this.tx = x;
    this.ty = y;
    this.size = special ? 2.8 : 2;
    this.color = color;
    this.special = special;
  }

  update(){
    this.x += (this.tx - this.x)*0.07;
    this.y += (this.ty - this.y)*0.07;
  }

  draw(){
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fillStyle = this.color;

    if(this.special){
      ctx.shadowColor = "#ff4d4d";
      ctx.shadowBlur = 18 + Math.sin(pulse)*8;
    } else {
      ctx.shadowColor = this.color;
      ctx.shadowBlur = 8;
    }

    ctx.fill();
    ctx.shadowBlur = 0;
  }

  explode(){
    this.tx = Math.random()*canvas.width;
    this.ty = Math.random()*canvas.height;
  }
}

class Star{
  constructor(){
    this.x = Math.random()*canvas.width;
    this.y = Math.random()*canvas.height;
    this.size = Math.random()*1.5;
    this.speed = Math.random()*0.12;
    this.opacity = Math.random()*0.7;
  }

  update(){
    this.y += this.speed;
    if(this.y > canvas.height){
      this.y = 0;
      this.x = Math.random()*canvas.width;
    }
  }

  draw(){
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fillStyle = `rgba(255,80,80,${this.opacity})`;
    ctx.fill();
  }
}

for(let i=0;i<130;i++){
  stars.push(new Star());
}

function drawBackground(){
  const gradient = ctx.createRadialGradient(
    canvas.width*0.5, canvas.height*0.5, 0,
    canvas.width*0.5, canvas.height*0.5, canvas.width
  );

  gradient.addColorStop(0,"rgba(120,0,0,0.6)");
  gradient.addColorStop(0.4,"rgba(60,0,0,0.6)");
  gradient.addColorStop(0.7,"rgba(30,0,0,0.7)");
  gradient.addColorStop(1,"black");

  ctx.fillStyle = gradient;
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

function wrapText(text, maxWidth){
  const words = text.split(" ");
  let lines = [];
  let currentLine = words[0];

  for(let i=1;i<words.length;i++){
    let word = words[i];
    let width = ctx.measureText(currentLine + " " + word).width;
    if(width < maxWidth){
      currentLine += " " + word;
    } else {
      lines.push(currentLine);
      currentLine = word;
    }
  }
  lines.push(currentLine);
  return lines;
}

function createText(text){
  particles = [];
  ctx.clearRect(0,0,canvas.width,canvas.height);

  let special = text === "es la nuestra.";
  let fontSize = canvas.width < 480 ? 28 : 65;
  if(special) fontSize += 6;

  ctx.fillStyle="white";
  ctx.font=`bold ${fontSize}px Georgia`;
  ctx.textAlign="center";

  const maxWidth = canvas.width*0.85;
  const lines = wrapText(text,maxWidth);
  const lineHeight = fontSize+8;
  const startY = canvas.height/2 - ((lines.length-1)*lineHeight)/2;

  lines.forEach((line,i)=>{
    ctx.fillText(line, canvas.width/2, startY + i*lineHeight);
  });

  const data = ctx.getImageData(0,0,canvas.width,canvas.height).data;

  for(let y=0;y<canvas.height;y+=4){
    for(let x=0;x<canvas.width;x+=4){
      const index = (y * canvas.width + x) * 4;
      if(data[index+3] > 150){
        let color = special ? "#ff9999" : "#ff2e63";
        particles.push(new Particle(x,y,color,special));
      }
    }
  }

  ctx.clearRect(0,0,canvas.width,canvas.height);
}

function animate(){
  pulse += 0.05;

  drawBackground();

  stars.forEach(s=>{
    s.update();
    s.draw();
  });

  particles.forEach(p=>{
    p.update();
    p.draw();
  });

  requestAnimationFrame(animate);
}

function nextText(){
  if(textIndex < texts.length){

    particles.forEach(p=>p.explode());

    setTimeout(()=>{
      createText(texts[textIndex]);
      textIndex++;
      setTimeout(nextText,6500);
    },1200);

  } else {
    document.getElementById("btn").style.opacity=1;
  }
}

animate();
createText(texts[textIndex]);
textIndex++;
setTimeout(nextText,6500);

document.addEventListener("click", function(){
  const audio = document.getElementById("musica");
  audio.volume = 0.5;
  audio.play();
},{once:true});

function irGaleria(){
  document.body.style.opacity="0";
  document.body.style.transition="1s";
  setTimeout(()=>{
    window.location.href="galeria.html";
  },1000);
}
</script>

</body>
</html>
